# 评分标准对照：系统性优化改进方案（KesPlus 高校选课管理系统）

> 目标：严格对齐 `1.txt` 的评分标准（基本要求 + 扩展要求 + 创新性与实用性 + 报告完整性），给出**可执行、可验收、可截图**的系统性优化改进方案与交付清单。

---

## 0. 评分标准对照总表（逐条可验收）

| 评分点（来自 1.txt） | 验收口径（必须“可证明”） | 当前资产/差距 | 方案落地与交付物 |
|---|---|---|---|
| (a) 基于 KES Plus 平台开发网站 | 可提供 KesPlus **项目导出包**；平台内可直接演示页面与数据源 | 仓库已有 DB+API+静态页；KesPlus 导出需补齐 | 在 KesPlus 按本方案创建页面/数据源/权限并导出到 `deliverables/kesplus_export/` |
| (a) 访问数据库；数据表≥5 | DB 中表数量与 ER 图；页面可完成 CRUD/查询/过程调用 | 已有 8 张表（满足） | 报告中列出表清单/字段字典/ER 图；页面中展示“查询+操作” |
| (a) 除登录外页面≥5 | 导出/演示中可点击进入 ≥5 个页面 | 静态页除登录目前仅 3 个 | KesPlus 内至少实现 **8+ 页面**（见 §2），并截图目录结构/菜单 |
| (b) 数据统计 + 图表展示 | 至少 2 类图表（柱/折/饼/热力） + 可切换筛选条件 | 目前统计为表格 | 新增“统计大屏（Vue+ECharts）”与“统计报表（KesPlus 图表组件）”双路径（见 §3） |
| (b) 纯手工设计 Vue 前端页面 | 不依赖模板市场：Vue 页面布局/组件/交互自写 | 当前为原生 HTML/JS | 提供 `web/vue-dashboard.html`（或 KesPlus 自定义页面）+ 组件拆分与说明 |
| (b) 自定义函数 + 前后端交互 | DB 函数/过程 + API/数据源调用 + 前端交互（筛选/导出/联动） | 已有 FN/PROC，交互可增强 | 新增统计函数/过程、推荐/冲突检测函数；页面实现联动筛选、导出、详情钻取 |
| (c) 创新性与实用性 | 有清晰痛点、用户故事、可演示功能 | 可在现有选课上升级 | 选课“冲突检测+时间表”、满员“候补队列”、个性化“推荐/画像”三选二落地（见 §4） |
| (d) 报告完整详实 | 报告含：数据库设计、功能介绍、运行截图、测试用例、部署步骤 | 仅有模板与部分说明 | 按 `项目报告模板.txt` 输出正式报告 + 截图清单（见 §6） |

---

## 1. 总体优化目标与系统边界

### 1.1 项目定位（写进报告“系统简介”）
- 面向高校的“选课 + 管理 + 数据分析”一体化系统：学生选课/退课与课表、教师查看授课与学生名单、管理员维护基础数据并查看统计。
- 强约束：基于 KesPlus 平台可演示与导出；数据库采用 Kingbase/PostgreSQL 兼容脚本与过程。

### 1.2 统一的验收口径（写进报告“需求分析”）
- **功能验收**：三角色分别完成主流程（登录 → 查询 → 操作 → 结果可见）。
- **数据一致性验收**：选课/退课后 `TB_COURSE.SELECTED_NUM` 与 `TB_STUDENT_COURSE` 一致（触发器保障）。
- **安全验收**：学生只能操作本人，教师只能看本人课程，管理员可维护全局。
- **可视化验收**：统计图表至少 2 种，并支持按学期/学院/教师筛选。

---

## 2. 基本要求落地（对应 1.txt(a)）

### 2.1 数据库访问与数据表（≥5）
现有表（满足≥5，建议在报告“数据库设计”中逐表说明）：
- `TB_USER`（账号/角色/状态/密码哈希）
- `TB_STUDENT`（学生档案）
- `TB_TEACHER`（教师档案）
- `TB_COURSE`（课程/容量/学期）
- `TB_STUDENT_COURSE`（选课记录/状态/时间）
- `TB_DEPARTMENT`（学院）
- `TB_MAJOR`（专业）
- `TB_SYS_PARAM`（学期与时间窗口参数）

**数据库访问方式（两条路径任选其一，建议双保险）**
1) KesPlus 直连数据库：页面数据源直接执行 SQL/调用存储过程（最符合“基于平台”）。  
2) Express API 间接访问：KesPlus 通过 HTTP 数据源调用 `/api/*`（便于鉴权与复用）。

> 建议：核心交易（选课/退课）走数据库存储过程；查询与可视化可走视图/函数，便于复用与性能优化。

### 2.2 页面数量（除登录外 ≥5）
为保证稳定达标，按角色规划 **至少 8 个页面**（实际建议 10+，便于展示完整性）：

**公共**
1) 登录页：`LOGIN_FORM`
2) 主页/导航：`MAIN_FRAME`

**学生（至少 3 页）**
3) 可选课程：`SELECTABLE`
4) 我的选课：`MY_COURSE`
5) 我的课表（创新点之一，建议 Vue）：`STU_TIMETABLE`

**教师（至少 2 页）**
6) 授课课程列表：`TEACHER_COURSE_LIST`
7) 选课情况/学生名单：`TEACHER_COURSE_STAT`

**管理员（至少 3 页）**
8) 学生管理：`STUDENT_LIST / STUDENT_EDIT`
9) 教师管理：`TEACHER_LIST / TEACHER_EDIT`
10) 课程管理：`COURSE_LIST / COURSE_EDIT`
11) 统计看板：`ADMIN_COURSE_STAT`（含图表）
12) 系统参数：`PARAM_MGR`（学期/时间窗口）

> 只要在 KesPlus 菜单中可点击进入并展示内容，即可计为“页面”。报告中需截图：菜单 + 页面标题/内容。

### 2.3 基于 KesPlus 平台开发（必须可导出）
按 `docs/archive/前端页面设计执行方案_KesPlus.txt` 执行，关键落地动作：
1) KesPlus 新建 Web 应用工程，配置数据库连接（数据源）。
2) 创建上述页面与菜单（按角色显示）。
3) 每个页面绑定数据源：列表查询、表单保存、过程调用（选/退课）、统计查询。
4) 统一上下文：登录成功缓存 `user_id/role/stu_id/tea_id/current_term`，并在数据源参数中自动带入（防越权）。
5) 导出项目：放入 `deliverables/kesplus_export/`，并在报告中注明导出路径与导出时间截图。

---

## 3. 扩展要求落地（对应 1.txt(b)）

### 3.1 数据统计与图表展示（必须“可看见”）

**统计指标（至少覆盖 3 个维度，便于写“实用性”）**
- 课程维度：容量、已选、余量、满员率（`selected_num/capacity`）
- 教师维度：教师名下课程的选课人数 TopN
- 学院/专业维度：学院课程需求分布、热门方向
- 时间维度（可选）：按天/小时的选课趋势（依赖 `SELECT_TIME`）

**图表设计（至少 2 种）**
- 柱状图：Top10 热门课程（已选人数）
- 饼图/环图：容量利用率区间分布（0-25/25-50/50-75/75-100/满员）
- 折线图（可选）：选课趋势（按天统计）

**数据来源（建议新增 2 个函数/视图，利于复用与评分）**
- `PROC_STAT_COURSE_SELECT(p_term)`：已有，做基础表格与柱图数据源
- 新增 `FN_STAT_COURSE_TOPN(p_term, p_limit)`：返回 TopN
- 新增 `FN_STAT_DEPT_DISTRIBUTION(p_term)`：按学院汇总
- 新增 `FN_STAT_SELECT_TREND(p_term, p_bucket)`：按日/小时聚合

> 报告要求：展示“统计 SQL/函数设计 + 图表截图 + 筛选交互截图”。

### 3.2 纯手工 Vue 前端页面（必须明确“Vue 在哪里”）

**推荐落地形态（两选一）**
1) 在本仓库新增 `web/vue-dashboard.html`：Vue3 + ECharts CDN，Express 静态托管（便于演示与截图）。  
2) 在 KesPlus 新增“自定义页面/自定义组件”：引入 Vue3（本地或平台资源）并手写组件。

**页面内容建议（建议做成“统计大屏”或“课表+冲突检测”，更有创新性）**
- 顶部：学期选择、角色信息、筛选条件（学院/教师/课程）
- 中部：3 个图表联动（点击柱状图 → 右侧显示课程详情/学生数）
- 底部：明细表格（分页/导出 CSV）

**“纯手工”判定要点（写进报告）**
- 布局、组件拆分、状态管理、事件联动均自行编写（不使用模板市场/一键生成页面）。
- 代码中体现：Vue 组件、`computed/watch`、`fetch` 与错误处理、ECharts option 自定义。

### 3.3 自定义函数与前后端交互（高级功能）

**后端/数据库自定义函数（建议至少新增 1~2 个，体现“高级”）**
- 课表冲突检测：`FN_CHECK_TIME_CONFLICT(p_stu_id, p_course_id, p_term)`  
  - 返回：是否冲突、冲突课程列表
  - 前端交互：选课前弹窗提示冲突原因，可选择“仍然选课/取消”
- 候补队列（创新点）：新增表 `TB_WAITLIST` + 过程 `PROC_JOIN_WAITLIST/PROC_PROCESS_WAITLIST`  
  - 满员时允许加入候补；退课触发处理队列（触发器/后台任务）
- 导出功能：后端提供 `/api/export/stat?term=...` 导出 CSV；前端一键下载

**前后端交互增强（KesPlus 与 Vue 均可实现）**
- 查询条件联动：学期变化 → 自动刷新所有统计图与表
- 详情钻取：点击图表某项 → 打开明细（课程学生列表/学院课程列表）
- 异常态体验：加载中、无数据、错误提示统一组件化

---

## 4. 创新性与实用性设计（对应 1.txt(c)）

> 原则：创新必须“可落地可演示”，避免只写概念。

### 4.1 推荐的 3 个创新点（建议至少实现其中 2 个）
1) 课表可视化 + 冲突检测（强实用）  
   - 学生选课前即时提示冲突；生成周课表视图（支持导出图片/ICS）。
2) 满员候补队列 + 自动补选（强实用/可写触发器与过程）  
   - 满员可加入候补；有人退课则按规则自动补选（公平性：先到先得/同专业优先）。
3) 选课推荐（创新+数据能力）  
   - 依据专业/学院、历史热门、相似学生选择，输出推荐列表；管理员可查看“推荐命中率/热门趋势”。

### 4.2 创新点的“可评分”表达方式（报告写法）
- 痛点 → 方案 → 数据表/过程/页面 → 演示路径 → 截图证据
- 给出 1~2 个量化指标：例如“冲突选课拦截次数”“候补转正率”“热门课程满员率”

---

## 5. 系统性优化（增强完成度与稳定性）

### 5.1 安全与权限（建议纳入报告“实现细节”）
- 登录鉴权：token/session；角色授权中间件；避免学生伪造 `stu_id` 操作他人。
- 输入校验：学期/ID/容量/时间窗口；统一错误码与提示文案（中文化）。
- 密码：哈希 + 复杂度 + 修改密码功能（`PROC_SET_PASSWORD` + 页面入口）。

### 5.2 性能与一致性
- 交易走存储过程；并发下 `SELECT ... FOR UPDATE` 锁定课程行；触发器维护人数一致性。
- 常用查询加索引（已包含），统计可用视图/物化视图（可选）。

### 5.3 测试与验收
- 数据库：扩展 `tests/db_trigger_procedure_tests.sql` 覆盖禁用用户、时间窗、满员、恢复选课等。
- 接口：补充 curl 用例（参见 `docs/TESTING.md`），并形成“验收清单”。

---

## 6. 报告与截图清单（对应 1.txt(d)）

按 `项目报告模板.txt` 组织章节，建议额外加入“评分点对照表”和“截图目录”。

### 6.1 必备内容清单（写作时逐条勾选）
1) 系统概述：背景、目标、角色、特色（包含创新点）
2) 需求分析：功能需求（分角色）、非功能需求（安全/性能/易用）
3) 数据库设计：
   - ER 图（核心实体与关系）
   - 表结构说明（字段字典、主外键、约束、索引）
   - 触发器设计（触发时机、作用、异常处理）
   - 存储过程/函数设计（入参出参、返回码、事务与并发）
4) 系统设计与实现：
   - KesPlus 页面与数据源：页面清单、数据源 SQL/过程、参数绑定、权限配置
   - Vue 页面：组件结构、交互流程、图表实现（关键代码片段可截取）
   - 后端（如采用）：API 列表、鉴权与错误处理
5) 系统测试：
   - 触发器测试用例（输入→预期→实际）
   - 存储过程测试用例
   - 功能测试用例（按角色主流程 + 异常流程）
6) 总结：完成情况、亮点、不足与可扩展方向

### 6.2 截图清单（用于“运行效果截图”）
- KesPlus：项目菜单（含≥5 页面入口）、关键页面运行效果（至少 8 张）
- 学生：可选课程、选课成功、我的选课、课表/冲突提示
- 教师：课程列表、学生名单/统计图
- 管理员：学生管理 CRUD、课程管理 CRUD、参数维护、统计图表与筛选
- 数据库：表结构（≥5 表）、外键/索引、触发器列表、过程/函数列表、关键 SQL/过程执行结果
- 测试：SQL 测试脚本运行结果/回滚说明

---

## 7. 里程碑与任务拆解（建议 6 天节奏，可按实际压缩）

### D1：基线与平台工程
- 确认 DB 脚本可一键初始化（01~04 + tests）
- KesPlus 建工程 + DB 数据源连通 + 登录页 + 主界面菜单

### D2：管理员 CRUD 页面（保证“页面数”与“数据库访问”）
- 学生/教师/课程管理页面 + 下拉数据源 + 保存/停用逻辑

### D3：学生选课链路
- SELECTABLE / MY_COURSE 页面 + 过程调用 + 提示与刷新
- 增加“修改密码”入口（可选加分）

### D4：统计与图表（扩展要求核心）
- KesPlus 统计页 + 图表组件（至少 2 种图）
- 新增统计函数/视图（TopN/分学院/趋势）

### D5：Vue 页面（扩展要求核心）
- 手写 Vue 页面 + 图表联动/钻取/导出
- 形成“创新点”演示路径（课表/候补/推荐至少一个）

### D6：测试、截图、报告与导出
- 完成测试用例、补齐截图、生成 KesPlus 导出 + DB 逻辑备份
- 输出最终报告与提交包目录结构

---

## 8. 最终提交包建议结构（便于验收）

```text
deliverables/
  kesplus_export/              # KesPlus 导出工程（必须）
backups/
  course_selection_db.sql      # 逻辑备份（必须）
report/
  高校选课管理系统设计报告.pdf   # 按模板完整（必须）
src/                           # 本仓库源码（可选按要求）
```
