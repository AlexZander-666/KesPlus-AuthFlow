KesPlus 前端页面设计执行方案
==========================

目标
- 在 KesPlus 完成高校选课管理系统的全部前端页面、数据源和权限控制，实现管理员/教师/学生的端到端操作，并满足作业导出与演示。

前置准备
- 数据库：已按 db/01~04 执行，存在存储过程 PROC_SELECT_COURSE、PROC_DROP_COURSE、PROC_STAT_COURSE_SELECT。
- 环境：KesPlus 已能连接数据库；确认 CURRENT_TERM 参数正确。
- 账号：使用种子数据 admin/t001/t002/s001/s002/s003。

通用规范
- 数据源命名：DS_<模块>_<用途>，过程调用型前缀 PROC_。
- 参数绑定：查询区控件名称与数据源参数一致；学期默认绑定 TB_SYS_PARAM.CURRENT_TERM。
- 校验：前端必填（账号/密码/课程号/学期等），学分/容量正数，状态/角色下拉固定值。
- 权限：登录后根据 ROLE 装载菜单；按钮与数据源按角色过滤；学生/教师数据源自动带入关联的 STU_ID/TEA_ID。
- 事务：按钮（选课/退课/保存）用独立事务；查询数据源自动提交。

页面与数据源清单（按角色）
1) 登录 LOGIN_FORM（所有角色）
   - 数据源：DS_LOGIN（调用 FN_LOGIN(:username, :password)，服务端完成密码哈希校验，返回 user_id/role/status/stu_id/tea_id）。
   - 事件：登录按钮校验 FN_LOGIN 结果与 status='1'，存储登录上下文（user_id、role、stu_id/tea_id），跳转 MAIN_FRAME；改密可用 PROC_SET_PASSWORD。

2) 主界面 MAIN_FRAME（所有角色）
   - 菜单动态：按 role 显示模块；管理员（学生/教师/课程/选课管理/统计/系统参数），教师（课程列表/选课情况），学生（可选课程/我的选课）。

管理员模块
3) 学生管理
   - STUDENT_LIST：DS_STUDENT_LIST（模糊查询 tb_student JOIN dept/major），分页；查询条件：学号/姓名/学院/专业/年级/状态。
   - STUDENT_EDIT：DS_STUDENT_FORM（单条），下拉 DS_DEPT_OPTIONS、DS_MAJOR_OPTIONS；保存 INSERT/UPDATE。

4) 教师管理
   - TEACHER_LIST：DS_TEACHER_LIST（模糊查询 tb_teacher JOIN dept），分页。
   - TEACHER_EDIT：DS_TEACHER_FORM；下拉 DS_DEPT_OPTIONS；保存 INSERT/UPDATE。

5) 课程管理
   - COURSE_LIST：DS_COURSE_LIST（按课程号/名/教师/学院/学期，JOIN teacher/department），显示容量/已选/状态；停开按钮 UPDATE status='0'。
   - COURSE_EDIT：DS_COURSE_FORM；下拉 DS_TEACHER_OPTIONS、DS_DEPT_OPTIONS；保存 INSERT/UPDATE，SELECTED_NUM 初始 0。

6) 选课管理（管理员代操作）
   - ADMIN_SELECT_DROP：DS_SC_ADMIN（查询 tb_student_course），行操作：代选/代退/删除异常记录。
   - 代选：调用 PROC_SELECT_COURSE(:stu_id, :course_id, :term, out_success, out_msg)。
   - 代退：调用 PROC_DROP_COURSE(:stu_id, :course_id, :term, out_success, out_msg)。

7) 统计查询
   - ADMIN_COURSE_STAT：数据源调用 PROC_STAT_COURSE_SELECT(:p_term)，显示课程号/名/教师/容量/已选/剩余，支持导出。

教师模块
8) 课程列表（教师视角）
   - TEACHER_COURSE_LIST：DS_TEA_COURSE（按当前教师 TEA_ID 过滤 TB_COURSE），显示容量/已选。

9) 选课情况
   - TEACHER_COURSE_STAT：DS_TEACHER_COURSE_STAT（查询其课程选课人数与学生列表，JOIN tb_student_course/tb_student），可展开学生清单。

学生模块
10) 可选课程 SELECTABLE
    - DS_SELECTABLE（查询 status='1' 且 selected_num<capacity，按课程号/名/教师/学院/学期筛选）。
    - 行按钮“选课”：调用 PROC_SELECT_COURSE(:stu_id, :course_id, :term, out_success, out_msg)，成功后刷新。

11) 我的选课 MY_COURSE
    - DS_MYCOURSE（按当前学生 STU_ID 和学期查询 tb_student_course JOIN tb_course）。
    - 行按钮“退课”：调用 PROC_DROP_COURSE(:stu_id, :course_id, :term, out_success, out_msg)，成功后刷新。

系统管理
12) 学院/专业管理
    - DEPT_MGR：DS_DEPT_LIST；新增/编辑/停用。
    - MAJOR_MGR：DS_MAJOR_LIST（JOIN dept）；学院下拉 DS_DEPT_OPTIONS。

13) 系统参数 PARAM_MGR
    - DS_PARAM（tb_sys_param）；编辑 PARAM_VALUE/REMARK，参数键只读。修改时间参数后提示重新测试选退课。

数据源与参数要点
- DS_DEPT_OPTIONS：SELECT dept_id, dept_name FROM tb_department WHERE status='1';
- DS_MAJOR_OPTIONS：SELECT major_id, major_name FROM tb_major WHERE status='1' AND dept_id=:dept_id;
- DS_TEACHER_OPTIONS：SELECT tea_id, tea_name FROM tb_teacher WHERE status='1';
- 所有列表类数据源开启分页与常用排序（课程号/学号/姓名）。

权限与上下文传递
- 登录成功后缓存：user_id、role、stu_id、tea_id、current_term。
- 学生/教师相关数据源自动带入 stu_id/tea_id，避免越权。
- 菜单与按钮根据 role 控制显示；管理员允许代选/代退，学生仅可操作本人记录，教师仅查看本人授课。

前端校验与交互
- 必填：登录用户名/密码、课程基本字段、学期、容量/学分为正数；选课/退课需存在学期。
- 状态切换：停用学生/教师/课程时给出确认提示；停用课程后列表刷新。
- 提示：过程调用返回 out_msg，失败不刷新，成功刷新数据源。

测试与验收步骤
1) 数据初始化：执行 db/01~04。
2) 角色用例：
   - 管理员：增删改学生/教师/课程，代选/代退，统计导出。
   - 学生：登录 -> 可选课程 -> 选课/退课 -> 我的选课校验。
   - 教师：查看课程列表与选课情况。
3) 异常用例：课程停开、容量占满、学生或教师状态禁用、退课超时。
4) 导出：KesPlus 导出项目；KStudio 逻辑备份；截图与报告按模板补充。

实施顺序（建议）
1) 登录与主界面骨架；完成角色菜单控制。
2) 基础数据（学院/专业/参数）页面与下拉数据源。
3) 管理员学生/教师/课程 CRUD 页面。
4) 学生端选课/退课、管理员代选代退。
5) 教师/管理员统计页面与导出。
6) 全角色回归、自测、导出交付。
